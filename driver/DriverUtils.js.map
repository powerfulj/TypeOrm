{"version":3,"sources":["../../src/driver/DriverUtils.ts"],"names":[],"mappings":"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","file":"DriverUtils.js","sourcesContent":["import { Driver } from \"./Driver\";\r\nimport { shorten } from \"../util/StringUtils\";\r\n\r\n    /**\r\n * Common driver utility functions.\r\n */\r\nexport class DriverUtils {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Static Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Normalizes and builds a new driver options.\r\n     * Extracts settings from connection url and sets to a new options object.\r\n     */\r\n    static buildDriverOptions(options: any, buildOptions?: { useSid: boolean }): any {\r\n        if (options.url) {\r\n            const parsedUrl = this.parseConnectionUrl(options.url);\r\n            let urlDriverOptions: any = {\r\n                type: parsedUrl.type,\r\n                host: parsedUrl.host,\r\n                username: parsedUrl.username,\r\n                password: parsedUrl.password,\r\n                port: parsedUrl.port,\r\n                database: parsedUrl.database\r\n            };\r\n            if (buildOptions && buildOptions.useSid) {\r\n                urlDriverOptions.sid = parsedUrl.database;\r\n            }\r\n            return Object.assign({}, options, urlDriverOptions);\r\n        }\r\n        return Object.assign({}, options);\r\n    }\r\n\r\n    /**\r\n     * Builds column alias from given alias name and column name,\r\n     * If alias length is greater than the limit (if any) allowed by the current\r\n     * driver, abbreviates the longest part (alias or column name) in the resulting\r\n     * alias.\r\n     *\r\n     * @param driver Current `Driver`.\r\n     * @param alias Alias part.\r\n     * @param column Name of the column to be concatened to `alias`.\r\n     *\r\n     * @return An alias allowing to select/transform the target `column`.\r\n     */\r\n    static buildColumnAlias({ maxAliasLength }: Driver, alias: string, column: string): string {\r\n        const columnAliasName = alias + \"_\" + column;\r\n\r\n        if (maxAliasLength && maxAliasLength > 0 && columnAliasName.length > maxAliasLength)\r\n            return alias.length > column.length\r\n                ? `${shorten(alias)}_${column}`\r\n                : `${alias}_${shorten(column)}`;\r\n\r\n        return columnAliasName;\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Private Static Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Extracts connection data from the connection url.\r\n     */\r\n    private static parseConnectionUrl(url: string) {\r\n        const type = url.split(\":\")[0];\r\n        const firstSlashes = url.indexOf(\"//\");\r\n        const preBase = url.substr(firstSlashes + 2);\r\n        const secondSlash = preBase.indexOf(\"/\");\r\n        const base = (secondSlash !== -1) ? preBase.substr(0, secondSlash) : preBase;\r\n        const afterBase = (secondSlash !== -1) ? preBase.substr(secondSlash + 1) : undefined;\r\n\r\n        const lastAtSign = base.lastIndexOf(\"@\");\r\n        const usernameAndPassword = base.substr(0, lastAtSign);\r\n        const hostAndPort = base.substr(lastAtSign + 1);\r\n\r\n        let username = usernameAndPassword;\r\n        let password = \"\";\r\n        const firstColon = usernameAndPassword.indexOf(\":\");\r\n        if (firstColon !== -1) {\r\n            username = usernameAndPassword.substr(0, firstColon);\r\n            password = usernameAndPassword.substr(firstColon + 1);\r\n        }\r\n        const [host, port] = hostAndPort.split(\":\");\r\n\r\n        return {\r\n            type: type,\r\n            host: host,\r\n            username: decodeURIComponent(username),\r\n            password: decodeURIComponent(password),\r\n            port: port ? parseInt(port) : undefined,\r\n            database: afterBase || undefined\r\n        };\r\n    }\r\n}\r\n"],"sourceRoot":".."}